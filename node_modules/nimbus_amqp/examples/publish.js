
var amqp = require('../index.js');
console.log(amqp);

amqp.factory({
//	host: 'rabbitmq-03.devel.nimbus',
	vhost: '/',
//    maxLength: 1000,
	exchanges: { test : {type: 'topic', ack: true, confirm: true} }
},
function(err, a){
	console.log("Amqp is ready", a.tasks, a);
    publish(a);
    setInterval(function(){ publish(a) }, 1000);
});

function publish(amqp){
	console.log("Publishing");
	big = "text";
	amqp.test.publish('test', big, function(err, data){
		if(err){
			console.warn("Got err publishing...", err, err.stack);
		}
		console.log("callback called", err, data);
	});
};


